# Document Service

Backend-сервис для работы с документами: создание, перевод по статусам, ведение истории изменений и конкурентное утверждение. В проект также входит отдельная утилита для массового создания документов и фоновые воркеры для пакетной обработки.



# Требования для запуска

* Java 17
* Maven
* Docker
* Docker Compose

# Запуск сервиса

1. Собрать проект:
   mvn clean package

2. Запустить сервис и базу данных:
   docker compose up --build

В результате будут запущены:

* PostgreSQL в Docker-контейнере
* backend-сервис document-service

Сервис доступен по адресу:
[http://localhost:8080](http://localhost:8080)

# Проверка работы сервиса

После запуска сервиса можно проверить работу API (например, через Postman).

Основные эндпоинты:

- POST /api/documents  
  Создание документа в статусе DRAFT.

- GET /api/documents/{id}  
  Получение документа по id вместе с историей.

- POST /api/documents/batch-get  
  Пакетное получение документов по списку id.

- POST /api/documents/submit  
  Пакетная отправка документов на согласование  
  (DRAFT -> SUBMITTED).

- POST /api/documents/approve  
  Пакетное утверждение документов  
  (SUBMITTED -> APPROVED).

- POST /api/documents/search  
  Поиск документов по фильтрам (статус, автор, период дат).

- POST /api/concurrent-approve  
  Проверка конкурентного утверждения одного документа.

# Фоновые воркеры

В сервисе работают два фоновых процесса:

1. SubmitWorker
   Регулярно выбирает документы в статусе DRAFT и отправляет их на согласование пачками.

2. ApproveWorker
   Регулярно выбирает документы в статусе SUBMITTED и отправляет их на утверждение пачками.

Размер пачки и задержка между запусками настраиваются через конфигурацию.
Частичные ошибки не останавливают работу воркеров.

# Логи

Логи пишутся в файл:
logs/app.log

По логам можно увидеть:

* прогресс работы фоновых воркеров
* обработку пачек документов
* выполнение утилиты генерации документов

# Утилита генерации документов

Утилита генерации находится в модуле document-generator.
Она предназначена для массового создания документов через API сервиса.

Перед запуском генератора сервис должен быть уже запущен.

# Запуск утилиты:
java -jar document-generator/target/document-generator-1.0-SNAPSHOT.jar

Параметры генерации (количество документов, автор, инициатор и адрес сервиса) задаются в application.yml утилиты.

Утилита выполняется один раз и завершает работу.

# Ответы на дополнительные вопросы
Что бы поменяли, чтобы один запрос уверенно работал с 5000+ id

Обработка уже атомарна на документ и уверенно работает и с 5000+ id. 
Я бы просто вынес в отдельный фоновый сервис и на запрос с 5000+ отдавал ответ с просьбой подождать.

Как бы вынесли реестр утверждений в отдельную систему

Реестр утверждений я бы вынес в отдельный сервис и управлял обеими транзакциями как одной (локальной и внешней).